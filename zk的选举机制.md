#### 新集群的选举

- 服务器1启动自己，给投票，然后发投票信息，由于其它机器还没有启动所以它收不到反馈信息，服务器1的状态一直属于Looking。
- 服务器2启动，给自己投票，同时与之前启动的服务器1交换结果，由于服务器2的编号大所以服务器2胜出，但此时投票数没有大于半数，所以两个服务器的状态依然是LOOKING。
- 服务器3启动，给自己投票，同时与之前启动的服务器1,2交换信息，由于服务器3的编号最大所以服务器3胜出，此时投票数正好大于半数，所以服务器3成为领导者 leader，服务器1,2成为小弟 follower。
- 服务器4启动，给自己投票，同时与之前启动的服务器1,2,3交换信息，尽管服务器4的编号大，但之前服务器3已经胜出，所以服务器4只能成为小弟 follower。
- 服务器5启动，后面的逻辑同服务器4成为小弟。

![1619800743605](E:\ZooKeep\Zookeper\assets\1619800743605.png)

#### 旧集群的选举

- 对于运行正常的zookeeper集群，中途有机器down掉，需要重新选举时，选举过程就需要加入数据ID、服务器ID和逻辑时钟。
  - 数据ID：数据新的version就大，数据每次更新都会更新version。
  - 服务器ID：就是我们配置的myid中的值，每个机器一个。
  - 逻辑时钟：这个值从0开始递增,每次选举对应一个值。 如果在同一次选举中,这个值是一致的。
- 这样选举的标准就变成：

​		1、逻辑时钟小的选举结果被忽略，重新投票；

​		2、统一逻辑时钟后，数据id大的胜出；

​		3、数据id相同的情况下，服务器id大的胜出；

根据这个规则选出leader。

